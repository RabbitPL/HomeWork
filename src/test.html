<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>demo 11</title>
    <script src="../build/react.js"></script>
    <script src="../build/react-dom.js"></script>
    <script src="../build/browser.min.js"></script>
    <script src="../build/jquery.min.js"></script>
</head>
<body>
<div id="demo"></div>
<script type="text/babel">
        var RepoList = React.createClass({
            getInitialState:function(){
                return {
                    loading: true,
                    error: null,
                    data: null
                };
            },
            componentDidMount: function(){
                this.props.promise.then(
                    value => this.setState({loading:false, data:value}),
                    error => this.setState({loading:false, error:error})
                )
            },
            getChildContext: function () {
                return { number: this.state.number };
            },
            render: function(){
                if(this.state.loading){
                    return <span>Loading...</span>;
                }else if(this.state.error !== null){
                    return <span>Error: {this.state.error.message}</span>
                }else{
                    var repos = this.state.data.items;
                    var repoList = repos.map(function(repo){
                        return (
                            <li><a href={repo.html_url}>{repo.name}</a>({repo.stargazers_count} starts)<br/>{repo.description}</li>
                        );
                    });
                    return (
                        <main>
                            <h1>Most popular Javascript Projects in GuiHub</h1>
                            <ol>{repoList}</ol>
                        </main>
                    );
                }
            }
        });
        ReactDOM.render(
            <RepoList promise={$.get('https://api.github.com/users/octocat/gists?q=javascript&sort=stars')}/>,
            document.body
        );
    </script>
</body>
</html>